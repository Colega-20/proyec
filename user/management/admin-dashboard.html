<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ComponentBox</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <link rel="shortcut icon" href="img.png" as="style" />
</head>

<body>
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="../../index.html" class="logo">
                <svg class="logo" id="logo" fill="#ccc" height="54px" width="54px" version="1.1"
                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512"
                    xml:space="preserve">
                    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                    <g id="SVGRepo_iconCarrier">
                        <g>
                            <g>
                                <g>
                                    <path
                                        d="M411.546,92.369H100.453c-4.466,0-8.084,3.618-8.084,8.084v311.092c0,4.466,3.618,8.084,8.084,8.084h228.114 c4.466,0,8.084-3.619,8.084-8.084s-3.618-8.084-8.084-8.084h-220.03V108.538h294.924v294.924h-45.792 c-4.466,0-8.084,3.619-8.084,8.084s3.618,8.084,8.084,8.084h53.876c4.466,0,8.084-3.619,8.084-8.084V100.453 C419.63,95.989,416.011,92.369,411.546,92.369z">
                                    </path>
                                    <path
                                        d="M503.915,295.084c4.466,0,8.084-3.618,8.084-8.084c0-4.466-3.618-8.084-8.084-8.084h-46.557v-45.83h46.557 c4.466,0,8.084-3.618,8.084-8.084c0-4.466-3.618-8.084-8.084-8.084h-46.557v-45.832h46.556v0.001 c4.466,0,8.084-3.619,8.084-8.084c0-4.466-3.618-8.084-8.084-8.084h-46.557v-45.83h46.557c4.466,0,8.084-3.619,8.084-8.084 s-3.618-8.084-8.084-8.084h-46.563c-0.104-21.059-17.213-38.169-38.272-38.272V8.084c0-4.466-3.619-8.084-8.084-8.084 c-4.465,0-8.084,3.619-8.084,8.084v46.559h-45.829V8.084c0-4.466-3.62-8.084-8.084-8.084c-4.466,0-8.084,3.619-8.084,8.084 v46.559h-45.831V8.084c0-4.466-3.619-8.084-8.084-8.084s-8.084,3.619-8.084,8.084v46.559h-45.83V8.084 C233.084,3.619,229.466,0,225,0s-8.084,3.619-8.084,8.084v46.559h-45.83V8.084c0-4.466-3.619-8.084-8.084-8.084 s-8.084,3.619-8.084,8.084v46.559h-45.83V8.084c0-4.466-3.619-8.084-8.084-8.084s-8.084,3.619-8.084,8.084v46.564 c-21.06,0.102-38.17,17.213-38.273,38.272H8.085c-4.466,0-8.084,3.619-8.084,8.084s3.618,8.084,8.084,8.084h46.557v45.83H8.085 c-4.466,0-8.084,3.618-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h46.557v45.832H8.085c-4.466,0-8.084,3.619-8.084,8.084 c0,4.466,3.618,8.084,8.084,8.084h46.557v45.83H8.085c-4.466,0-8.084,3.619-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h46.557 v45.83H8.085c-4.466,0-8.084,3.619-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h46.557v45.83H8.085 c-4.466,0-8.084,3.619-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h46.563c0.103,21.06,17.214,38.169,38.273,38.272v46.562 c0,4.466,3.618,8.084,8.084,8.084c4.466,0,8.084-3.618,8.084-8.084v-46.559h45.83v46.559c0,4.466,3.618,8.084,8.084,8.084 c4.466,0,8.084-3.618,8.084-8.084v-46.559h45.83v46.559c0,4.466,3.618,8.084,8.084,8.084c4.466,0,8.084-3.618,8.084-8.084 v-46.559h45.83v46.559c0,4.466,3.618,8.084,8.084,8.084c4.466,0,8.084-3.618,8.084-8.084v-46.559h45.831v46.559 c0,4.466,3.619,8.084,8.084,8.084c4.465,0,8.084-3.618,8.084-8.084v-46.559h45.829v46.559c0,4.466,3.62,8.084,8.084,8.084 c4.466,0,8.084-3.618,8.084-8.084v-46.564c21.059-0.104,38.169-17.213,38.272-38.272h46.563c4.466,0,8.084-3.619,8.084-8.084 s-3.618-8.084-8.084-8.084h-46.557v-45.83h46.557c4.466,0,8.084-3.619,8.084-8.084s-3.618-8.084-8.084-8.084h-46.557v-45.829 H503.915z M418.889,441.189h-69.873c-0.006,0-0.012-0.001-0.018-0.001c-0.007,0-0.012,0.001-0.018,0.001h-61.963 c-0.007,0-0.012-0.001-0.018-0.001s-0.012,0.001-0.018,0.001h-61.962c-0.006,0-0.012-0.001-0.018-0.001s-0.012,0.001-0.018,0.001 h-61.962c-0.006,0-0.012-0.001-0.018-0.001s-0.012,0.001-0.018,0.001h-61.96c-0.006,0-0.012-0.001-0.018-0.001 c-0.006,0-0.012,0.001-0.018,0.001H93.11c-12.296,0-22.299-10.003-22.299-22.299V93.111c0-12.296,10.003-22.299,22.299-22.299 h7.874c0.008,0,0.014,0.001,0.02,0.001c0.006,0,0.014-0.001,0.021-0.001h61.956c0.008,0,0.014,0.001,0.021,0.001 c0.006,0,0.014-0.001,0.02-0.001h61.956c0.008,0,0.014,0.001,0.021,0.001s0.014-0.001,0.02-0.001h61.956 c0.008,0,0.014,0.001,0.021,0.001s0.014-0.001,0.021-0.001h61.957c0.008,0,0.014,0.001,0.021,0.001 c0.006,0,0.014-0.001,0.02-0.001h69.87c12.296,0,22.299,10.003,22.299,22.299v325.779h0.003 C441.188,431.185,431.185,441.189,418.889,441.189z">
                                    </path>
                                    <path
                                        d="M354.241,162.817c4.466,0,8.084-3.618,8.084-8.084c0-4.466-3.618-8.084-8.084-8.084h-4.654 c-4.466,0-8.084,3.618-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084H354.241z">
                                    </path>
                                    <path
                                        d="M322.099,146.649H157.758c-4.466,0-8.084,3.618-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h164.341 c4.466,0,8.084-3.618,8.084-8.084C330.183,150.267,326.565,146.649,322.099,146.649z">
                                    </path>
                                    <path
                                        d="M354.241,232.161h-4.654c-4.466,0-8.084,3.618-8.084,8.084c0,4.466,3.618,8.084,8.084,8.084h4.654 c4.466,0,8.084-3.618,8.084-8.084C362.325,235.78,358.706,232.161,354.241,232.161z">
                                    </path>
                                    <path
                                        d="M330.183,240.245c0-4.466-3.618-8.084-8.084-8.084H157.758c-4.466,0-8.084,3.618-8.084,8.084 c0,4.466,3.618,8.084,8.084,8.084h164.341C326.565,248.33,330.183,244.71,330.183,240.245z">
                                    </path>
                                    <path
                                        d="M157.758,205.574h4.654c4.466,0,8.084-3.618,8.084-8.084c0-4.466-3.618-8.084-8.084-8.084h-4.654 c-4.466,0-8.084,3.618-8.084,8.084C149.674,201.955,153.293,205.574,157.758,205.574z">
                                    </path>
                                    <path
                                        d="M181.815,197.49c0,4.466,3.619,8.084,8.084,8.084h164.341c4.466,0,8.084-3.618,8.084-8.084 c0-4.466-3.618-8.084-8.084-8.084H189.9C185.434,189.406,181.815,193.024,181.815,197.49z">
                                    </path>
                                    <path
                                        d="M157.758,314.637c-4.466,0-8.084,3.619-8.084,8.084s3.618,8.084,8.084,8.084h5.244c4.466,0,8.084-3.619,8.084-8.084 s-3.619-8.084-8.084-8.084H157.758z">
                                    </path>
                                    <path
                                        d="M196.615,314.637c-4.466,0-8.084,3.619-8.084,8.084s3.619,8.084,8.084,8.084h5.244c4.466,0,8.084-3.619,8.084-8.084 s-3.618-8.084-8.084-8.084H196.615z">
                                    </path>
                                    <path
                                        d="M235.473,314.637c-4.466,0-8.084,3.619-8.084,8.084s3.618,8.084,8.084,8.084h5.245c4.466,0,8.084-3.619,8.084-8.084 s-3.619-8.084-8.084-8.084H235.473z">
                                    </path>
                                    <path
                                        d="M362.325,344.332v-43.221c0-11.59-9.429-21.019-21.019-21.019h-43.221c-11.59,0-21.019,9.429-21.019,21.019v43.221 c0,11.59,9.429,21.019,21.019,21.019h43.221C352.896,365.351,362.325,355.922,362.325,344.332z M346.157,344.332 c0,2.674-2.175,4.851-4.851,4.851h-43.221c-2.674,0-4.851-2.176-4.851-4.851v-43.221c0-2.674,2.176-4.851,4.851-4.851h43.221 c2.675,0,4.851,2.176,4.851,4.851V344.332z">
                                    </path>
                                </g>
                            </g>
                        </g>
                    </g>
                </svg>
                <span class="logo-text">ComponentBox</span>
            </a>
            <button id="theme-toggle" aria-label="Cambiar tema">
                <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>

                <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
            </button>
        </div>
    </nav>
    <div class="floating-home">
        <a href="../user.html" class="floating-btn" title="Regresar al Inicio">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span class="floating-text">Home</span>
        </a>
    </div>
    <!-- Toast Notification. don't toch-->
    <div id="toast" class="toast"></div>
    <!-- Admin section-->
    <section class="admin-section">
        <div class="container">

            <div class="admin-controls">
                <h2 class="section-title">Admin management</h2>
                <div class="button-group">
                    <button class="btn btn-outline active" id="btn-partners"
                        onclick="window.loadCollection('partner_requests')">üìß Solicitudes Partner</button>
                    <button class="btn btn-outline" id="btn-support"
                        onclick="window.loadCollection('support_tickets')">üé´ Tickets Sopport</button>
                    <button class="btn btn-outline" id="btn-users" onclick="window.switchToUserManager()">üë§ User
                        managements</button>
                </div>
            </div>

            <div id="user-manager-section" style="display: none; margin-top: 20px;">

                <div class="search-box-container">
                    <input type="text" id="search-uid-input" placeholder="Pegar User UID aqu√≠ (ej: go0GqHv...)"
                        class="admin-input">
                    <button onclick="window.searchUserByUid()" class="btn-filter active">üîç User search (ID)</button>
                </div>

                <div id="user-editor-panel" style="display: none;">
                    <div class="user-edit-card">
                        <h3>üìù Perfil Edit</h3>
                        <div class="edit-grid">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="edit-fullname">
                            </div>
                            <div class="form-group">
                                <label>Email (Solo lectura)</label>
                                <input type="text" id="edit-email" readonly style="opacity: 0.7;">
                            </div>
                            <div class="form-group">
                                <label>Registrado (Solo lectura)</label>
                                <input type="text" id="edit-registeredAt" readonly style="opacity: 0.7;">
                            </div>
                            <div class="form-group">
                                <label>Rank</label>
                                <select id="edit-rank">
                                    <option value="Standard User">Standard User</option>
                                    <option value="VIP User">VIP User</option>
                                    <option value="BetaTester User">BetaTester User</option>
                                    <option value="Admin User">Admin User</option>
                                    <option value="Developer User">Developer User</option>
                                    <option value="Administrative User">Administrative User</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Gender</label>
                                <select id="edit-gender">
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>birthDate</label>
                                <input type="date" id="edit-birthdate" placeholder="Date" max="2025-12-31">
                            </div>
                            <div class="form-group">
                                <label>Age</label>
                                <input type="number" id="edit-age">
                            </div>
                            <div class="form-group">
                                <label>VIP Redeemed At</label>
                                <select id="edit-vip-redeemed" class="admin-input"
                                    style="width: 100%; cursor: pointer;">
                                    <option value="null">null (Sin canjear)</option>
                                    <option value="now" id="option-current-date">Fecha Actual (Cargando...)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>VIP Exp</label>
                                <select type="text" id="edit-vip-exp" placeholder="Ej: 1 Year or null">
                                    <option value="1 Year">1 Year</option>
                                    <option value="90 Days">3 Month</option>
                                    <option value="30 Days">30 Days</option>
                                    <option value="5 Min">5 Min</option>
                                    <option value="2 Min">2 Min (para pruebas)</option>
                                    <option value=""></option>
                                </select>
                            </div>
                            <div class="form-group checkbox-group">
                                <label>Is VIP?</label>
                                <input type="checkbox" id="edit-isvip">
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top: 15px;">
                            <button onclick="window.saveUserChanges()" class="btn btn-admin-approve">üíæ Save</button>
                        </div>
                    </div>
                    <h3>üìÇ Sub-Colecciones del Usuario</h3>
                    <div class="subcollections-area">
                        <div class="collection-viewer">
                            <h4>My Requests (Historial)</h4>
                            <div id="sub-requests-list" class="mini-list">Loanding...</div>
                        </div>

                        <div class="collection-viewer">
                            <h4>Orders</h4>
                            <div id="sub-orders-list" class="mini-list">Loanding...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="filter-controls">
                <button class="btn-filter active" onclick="window.applyDOMFilter('all', this)">üìã All</button>
                <button class="btn-filter" onclick="window.applyDOMFilter('approved', this)">‚úÖ Approved</button>
                <button class="btn-filter" onclick="window.applyDOMFilter('resolved', this)">‚úîÔ∏è Resolved</button>
                <button class="btn-filter" onclick="window.applyDOMFilter('pending', this)">‚è≥ Pending</button>
                <button class="btn-filter" onclick="window.applyDOMFilter('rejected', this)">‚ùå Rejected</button>
                <button class="btn-filter" onclick="window.applyDOMFilter('rank', this)">üèÜ Rank</button>
            </div>

            <div id="admin-results" class="results-grid">
                <p style="text-align: center; color: var(--text-muted);">Loading Logs...</p>
            </div>

        </div>
    </section>
    <div id="google_translate_element" style="display:none;"></div>
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,es,fr,it',
                autoDisplay: true,
                multilanguagePage: true,
            }, 'google_translate_element');
        }

        // Este c√≥digo revisa si la cookie existe y fuerza el hash en la URL si no est√° presente
        (function checkLangCookie() {
            const match = document.cookie.match(new RegExp('(^| )googtrans=([^;]+)'));
            if (match) {
                const langValue = match[2];
                if (!window.location.hash.includes('#googtrans')) {
                    window.location.hash = `#googtrans(${langValue})`;
                }
            }
        })();
    </script>
    <script type="module">
        // ==========================================
        // 1. IMPORTACIONES (Actualizadas)
        // ==========================================
        // Aseg√∫rate de tener estas importaciones arriba

        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import {
            getFirestore,
            collection,
            addDoc, getDoc, doc,
            serverTimestamp,
            query,
            orderBy,
            getDocs,
            deleteDoc,
            updateDoc,
            limit,
            setDoc,
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: 'AIzaSyDvuSzMlZzxDLnYFBDMQSlwcj11BQtx9jI',
            authDomain: 'database-4ed5a.firebaseapp.com',
            databaseURL: 'https://database-4ed5a-default-rtdb.firebaseio.com/',
            projectId: 'database-4ed5a',
            storageBucket: 'database-4ed5a.firebasestorage.app',
            messagingSenderId: '515978040414',
            appId: '1:515978040414:web:f3572d27f9ab24a7c6d0cf',
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ... dentro de onAuthStateChanged ...
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = '../../login-register/login-register.html';
            } else {
                try {
                    // Definimos la referencia al documento
                    const userRef = doc(db, "users", user.uid);
                    // Obtenemos el documento
                    const userSnap = await getDoc(userRef);

                    if (userSnap.exists()) {
                        const userData = userSnap.data();
                        const rank = userData.rank || 'Standard User';

                        const allowedRanks = ['BetaTester User', 'Admin User', 'Developer User', "Adminitrative User"];

                        if (allowedRanks.includes(rank)) {
                            showToast("User allowed, Welcome.", "success",);
                        } else {
                            console.warn("Rank not authorized:", rank);
                            alert("Rank not authorized:", rank)
                            window.location.href = '../../login-register/login-register.html';
                        }

                    } else {
                        console.error("No se encontr√≥ el documento del usuario en Firestore.");
                        alert("No se encontr√≥ el documento del usuario en Firestore.")
                        window.location.href = '../../login-register/login-register.html';
                    }
                } catch (error) {
                    console.error('Error al obtener datos de Firestore:', error);
                    showToast('Error al obtener datos de Firestore:', "error")
                }
            }
        });

        // Show toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;

            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }
    </script>
    <script type="module" src="logic.js"></script>
    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>