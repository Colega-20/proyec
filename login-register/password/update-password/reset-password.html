<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Passawod</title>
    <link rel="stylesheet" href="auth-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="shortcut icon" href="img.png" as="style" />
</head>

<body>
    <div class="background-animation"></div>
    <div id="toast" class="toast"></div>
    <div class="auth-container">

        <div class="auth-card">
            <div id="loading-reset" style="display: none;">
                <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #a855f7;"></i>
                <p>cheking link...</p>
            </div>

            <div id="reset-form">
                <h2>New Password</h2>
                <p style="color: #998; margin: 4px 0 8px;">Set New Seve Password.</p>

                <div class="input-group">
                    <label>New Passwor</label>
                    <div class="password-wrapper" style="position: relative;">
                        <input type="password" maxlength="32" id="new-password" placeholder="••••••••" required>
                        <i onclick="togglePass(this, 'new-password')" class="fas fa-eye"
                            style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #777;"></i>
                    </div>
                </div>

                <div id="strength_conteiner">
                    <div class="password-strength-container" id="password-strength-container">
                        <div id="strength-bar" class="strength-bar"></div>
                    </div>
                    <small id="strength-text" style="color: #998; font-size: 11px;"></small>
                </div>


                <div class="input-group">
                    <label>Confirming password</label>
                    <input type="password" id="confirm-password" placeholder="••••••••" required>
                </div>

                <button id="btn-save-pass" class="btn-action">Save Password</button>
            </div>

            <div id="error-message" style="display: none;">
                <i class="fas fa-exclamation-circle" style="font-size: 2.5rem; color: #ff4d4d;"></i>
                <p style="margin-top: 15px;">the link has expired or it has alredy expired.</p>
                <a href="../password.html" class="btn-action"
                    style="text-decoration: none; display: block; margin-top: 20px;">Pedir nuevo enlace</a>
            </div>
        </div>
    </div>
    <div id="google_translate_element" style="display:none;">
    </div>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script defer type="module" src="update-password.js"></script>
    <script>
        const strengthBar = document.getElementById('strength-bar');
        const strengthText = document.getElementById('strength-text');
        const PassInput = document.getElementById('new-password');

        function togglePass(icon, id) {
            const input = document.getElementById(id);
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        // Este código revisa si la cookie existe y fuerza el hash en la URL si no está presente
        (function checkLangCookie() {
            const match = document.cookie.match(new RegExp('(^| )googtrans=([^;]+)'));
            if (match) {
                const langValue = match[2];
                if (!window.location.hash.includes('#googtrans')) {
                    window.location.hash = `#googtrans(${langValue})`;
                }
            }
        })();

        // Password strength indicator
        PassInput.addEventListener('input', () => {
            const val = PassInput.value;
            let strength = 0;

            // Validation logic
            if (val.length >= 7) strength++; // Minimum length
            if (/[A-Z]/.test(val)) strength++; // Has uppercase
            if (/[0-9]/.test(val) || /[^A-Za-z0-9]/.test(val)) strength++; // Numbers or symbols

            if (val.length >= 1) {
                document.getElementById("password-strength-container").style.opacity = "1"
                strengthBar.classList.add('weak');
                strengthText.textContent = 'too Weak - Add numbers or uppercase';
                strengthText.style.color = 'hsl(0, 72%, 51%)';

                document.getElementById('strength_conteiner').style.display = "flex"
            } else if (val.length <= 0) {
                strengthText.textContent = '';

                document.getElementById('strength_conteiner').style.display = "none"
            }

            // Clear previous classes
            strengthBar.className = 'strength-bar';
            if (val.length === 0) {
                document.getElementById("password-strength-container").style.opacity = "0"
            } else if (strength === 1) {
                strengthBar.classList.add('weak');
                strengthText.textContent = 'Weak - Add numbers or uppercase';
                strengthText.style.color = 'hsl(0, 72%, 51%)';
            } else if (strength === 2) {
                strengthBar.classList.add('medium');
                strengthText.textContent = 'Medium - Add symbols or capital';
                strengthText.style.color = '#ffaa00';
            } else if (strength === 3) {
                strengthBar.classList.add('strong');
                strengthText.textContent = 'Strong password!';
                strengthText.style.color = '#00ff88';
            }
        });

        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,es,fr,it',
                autoDisplay: true,
                multilanguagePage: true,
            }, 'google_translate_element');
        }

        // Este código revisa si la cookie existe y fuerza el hash en la URL si no está presente
        (function checkLangCookie() {
            const match = document.cookie.match(new RegExp('(^| )googtrans=([^;]+)'));
            if (match) {
                const langValue = match[2];
                if (!window.location.hash.includes('#googtrans')) {
                    window.location.hash = `#googtrans(${langValue})`;
                }
            }
        })();
    </script>

    <script type="text/javascript"
        src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>

</html>